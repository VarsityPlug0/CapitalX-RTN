{% extends 'base.html' %}
{% load static %}

{% block title %}Unified Admin Dashboard{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="display-4">Unified Admin Dashboard</h1>
            <p class="text-muted">Complete management system for all platform operations</p>
        </div>
    </div>

    <!-- Quick Stats Overview -->
    <div class="row mb-4">
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card bg-primary text-white h-100">
                <div class="card-body">
                    <h5>Users</h5>
                    <h2>{{ total_users }}</h2>
                    <small>Registered users</small>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card bg-success text-white h-100">
                <div class="card-body">
                    <h5>Deposits</h5>
                    <h2>R{{ approved_deposits_amount }}</h2>
                    <small>{{ approved_deposits_count }} approved</small>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card bg-info text-white h-100">
                <div class="card-body">
                    <h5>Investments</h5>
                    <h2>R{{ total_investments_amount }}</h2>
                    <small>{{ active_investments_count }} active</small>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card bg-warning text-dark h-100">
                <div class="card-body">
                    <h5>Returns</h5>
                    <h2>R{{ total_returns_amount }}</h2>
                    <small>{{ completed_investments_count }} completed</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Financial Management Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-dark text-light">
                <div class="card-header">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-money-bill-wave"></i> Financial Management
                    </h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- Deposit Management -->
                        <div class="col-md-4 mb-3">
                            <div class="card bg-secondary text-light h-100">
                                <div class="card-body">
                                    <h5>Deposit Management</h5>
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <p class="mb-1"><strong>Pending:</strong> {{ pending_deposits_count }}</p>
                                            <p class="mb-1"><strong>Amount:</strong> R{{ pending_deposits_amount }}</p>
                                        </div>
                                        <div>
                                            <p class="mb-1"><strong>Approved:</strong> {{ approved_deposits_count }}</p>
                                            <p class="mb-1"><strong>Amount:</strong> R{{ approved_deposits_amount }}</p>
                                        </div>
                                    </div>
                                    <a href="{% url 'deposit_dashboard' %}" class="btn btn-primary btn-sm mt-2">
                                        <i class="fas fa-cog"></i> Manage Deposits
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Withdrawal Management -->
                        <div class="col-md-4 mb-3">
                            <div class="card bg-secondary text-light h-100">
                                <div class="card-body">
                                    <h5>Withdrawal Management</h5>
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <p class="mb-1"><strong>Pending:</strong> {{ pending_withdrawals_count }}</p>
                                            <p class="mb-1"><strong>Amount:</strong> R{{ pending_withdrawals_amount }}</p>
                                        </div>
                                        <div>
                                            <p class="mb-1"><strong>Approved:</strong> {{ approved_withdrawals_count }}</p>
                                            <p class="mb-1"><strong>Amount:</strong> R{{ approved_withdrawals_amount }}</p>
                                        </div>
                                    </div>
                                    <a href="{% url 'admin:core_withdrawal_changelist' %}" class="btn btn-primary btn-sm mt-2">
                                        <i class="fas fa-cog"></i> Manage Withdrawals
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Investment Management -->
                        <div class="col-md-4 mb-3">
                            <div class="card bg-secondary text-light h-100">
                                <div class="card-body">
                                    <h5>Investment Management</h5>
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <p class="mb-1"><strong>Active:</strong> {{ active_investments_count }}</p>
                                            <p class="mb-1"><strong>Amount:</strong> R{{ active_investments_amount }}</p>
                                        </div>
                                        <div>
                                            <p class="mb-1"><strong>Completed:</strong> {{ completed_investments_count }}</p>
                                            <p class="mb-1"><strong>Amount:</strong> R{{ completed_investments_amount }}</p>
                                        </div>
                                    </div>
                                    <a href="{% url 'admin:core_investment_changelist' %}" class="btn btn-primary btn-sm mt-2">
                                        <i class="fas fa-cog"></i> Manage Investments
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User & Platform Management Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-dark text-light">
                <div class="card-header">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-users-cog"></i> User & Platform Management
                    </h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- User Management -->
                        <div class="col-md-4 mb-3">
                            <div class="card bg-secondary text-light h-100">
                                <div class="card-body">
                                    <h5>User Management</h5>
                                    <p class="mb-1"><strong>Total Users:</strong> {{ total_users }}</p>
                                    <div class="d-flex justify-content-between">
                                        <span>Level 1: {{ level_1_users }}</span>
                                        <span>Level 2: {{ level_2_users }}</span>
                                        <span>Level 3: {{ level_3_users }}</span>
                                    </div>
                                    <a href="{% url 'manage_users' %}" class="btn btn-primary btn-sm mt-2">
                                        <i class="fas fa-users"></i> Manage Users
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Company Management -->
                        <div class="col-md-4 mb-3">
                            <div class="card bg-secondary text-light h-100">
                                <div class="card-body">
                                    <h5>Company Management</h5>
                                    <p class="mb-1"><strong>Total Companies:</strong> {{ companies_count }}</p>
                                    <a href="{% url 'manage_companies' %}" class="btn btn-primary btn-sm mt-2">
                                        <i class="fas fa-building"></i> Manage Companies
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Investment Plans Management -->
                        <div class="col-md-4 mb-3">
                            <div class="card bg-secondary text-light h-100">
                                <div class="card-body">
                                    <h5>Investment Plans</h5>
                                    <p class="mb-1"><strong>Total Plans:</strong> {{ investment_plans_count|default:0 }}</p>
                                    <a href="{% url 'manage_investment_plans' %}" class="btn btn-primary btn-sm mt-2">
                                        <i class="fas fa-chart-line"></i> Manage Plans
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Lead Management Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-dark text-light">
                <div class="card-header">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-envelope"></i> Lead Management
                    </h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- Lead Management -->
                        <div class="col-md-6 mb-3">
                            <div class="card bg-secondary text-light h-100">
                                <div class="card-body">
                                    <h5>Lead Management</h5>
                                    <p class="mb-1"><strong>Total Campaigns:</strong> {{ total_campaigns }}</p>
                                    <p class="mb-1"><strong>Total Leads:</strong> {{ total_leads }}</p>
                                    <p class="mb-1"><strong>Pending:</strong> {{ pending_leads }}</p>
                                    <a href="{% url 'lead_dashboard' %}" class="btn btn-primary btn-sm mt-2">
                                        <i class="fas fa-envelope"></i> Manage Leads
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- System Statistics -->
                        <div class="col-md-6 mb-3">
                            <div class="card bg-secondary text-light h-100">
                                <div class="card-body">
                                    <h5>System Statistics</h5>
                                    <p class="mb-1"><strong>Active Users:</strong> {{ active_users_count|default:0 }}</p>
                                    <p class="mb-1"><strong>Pending Referrals:</strong> {{ pending_referrals_count|default:0 }}</p>
                                    <p class="mb-1"><strong>Total Referral Rewards:</strong> R{{ total_referral_rewards|default:0 }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activities Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-dark text-light">
                <div class="card-header">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-history"></i> Recent Activities
                    </h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- Recent Deposits -->
                        <div class="col-md-3 mb-3">
                            <div class="card bg-secondary text-light h-100">
                                <div class="card-body">
                                    <h5>Recent Deposits</h5>
                                    <ul class="list-unstyled">
                                        {% for deposit in recent_deposits %}
                                        <li class="mb-2">
                                            <small>
                                                <strong>{{ deposit.user.email }}</strong><br>
                                                R{{ deposit.amount }} - 
                                                {% if deposit.status == 'pending' %}
                                                    <span class="badge bg-warning">Pending</span>
                                                {% elif deposit.status == 'approved' %}
                                                    <span class="badge bg-success">Approved</span>
                                                {% else %}
                                                    <span class="badge bg-danger">Rejected</span>
                                                {% endif %}<br>
                                                <span class="text-muted">{{ deposit.created_at|date:"M d, H:i" }}</span>
                                            </small>
                                        </li>
                                        {% empty %}
                                        <li><small>No recent deposits</small></li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Withdrawals -->
                        <div class="col-md-3 mb-3">
                            <div class="card bg-secondary text-light h-100">
                                <div class="card-body">
                                    <h5>Recent Withdrawals</h5>
                                    <ul class="list-unstyled">
                                        {% for withdrawal in recent_withdrawals %}
                                        <li class="mb-2">
                                            <small>
                                                <strong>{{ withdrawal.user.email }}</strong><br>
                                                R{{ withdrawal.amount }} - 
                                                {% if withdrawal.status == 'pending' %}
                                                    <span class="badge bg-warning">Pending</span>
                                                {% elif withdrawal.status == 'approved' %}
                                                    <span class="badge bg-success">Approved</span>
                                                {% else %}
                                                    <span class="badge bg-danger">Rejected</span>
                                                {% endif %}<br>
                                                <span class="text-muted">{{ withdrawal.created_at|date:"M d, H:i" }}</span>
                                            </small>
                                        </li>
                                        {% empty %}
                                        <li><small>No recent withdrawals</small></li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Investments -->
                        <div class="col-md-3 mb-3">
                            <div class="card bg-secondary text-light h-100">
                                <div class="card-body">
                                    <h5>Recent Investments</h5>
                                    <ul class="list-unstyled">
                                        {% for investment in recent_investments %}
                                        <li class="mb-2">
                                            <small>
                                                <strong>{{ investment.user.email }}</strong><br>
                                                R{{ investment.amount }} in {{ investment.company.name }}<br>
                                                <span class="text-muted">{{ investment.created_at|date:"M d, H:i" }}</span>
                                            </small>
                                        </li>
                                        {% empty %}
                                        <li><small>No recent investments</small></li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Users -->
                        <div class="col-md-3 mb-3">
                            <div class="card bg-secondary text-light h-100">
                                <div class="card-body">
                                    <h5>Recent Users</h5>
                                    <ul class="list-unstyled">
                                        {% for user in recent_users %}
                                        <li class="mb-2">
                                            <small>
                                                <strong>{{ user.email }}</strong><br>
                                                Level {{ user.level }}<br>
                                                <span class="text-muted">{{ user.date_joined|date:"M d, H:i" }}</span>
                                            </small>
                                        </li>
                                        {% empty %}
                                        <li><small>No recent users</small></li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Activity Log -->
    {% if recent_activity %}
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-dark text-light">
                <div class="card-header">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-clipboard-list"></i> Recent Admin Activity
                    </h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-dark table-hover">
                            <thead>
                                <tr>
                                    <th>Admin</th>
                                    <th>Action</th>
                                    <th>Details</th>
                                    <th>Time</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for activity in recent_activity %}
                                <tr>
                                    <td>{{ activity.admin_user.username }}</td>
                                    <td>{{ activity.action }}</td>
                                    <td>{{ activity.details }}</td>
                                    <td>{{ activity.timestamp|date:"Y-m-d H:i" }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Quick Access Links -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-dark text-light">
                <div class="card-header">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-link"></i> Quick Access
                    </h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 mb-2">
                            <a href="{% url 'manage_users' %}" class="btn btn-outline-primary w-100">
                                <i class="fas fa-users"></i> Users
                            </a>
                        </div>
                        <div class="col-md-3 mb-2">
                            <a href="{% url 'admin:core_deposit_changelist' %}" class="btn btn-outline-primary w-100">
                                <i class="fas fa-file-invoice-dollar"></i> Deposits
                            </a>
                        </div>
                        <div class="col-md-3 mb-2">
                            <a href="{% url 'admin:core_withdrawal_changelist' %}" class="btn btn-outline-primary w-100">
                                <i class="fas fa-money-check-alt"></i> Withdrawals
                            </a>
                        </div>
                        <div class="col-md-3 mb-2">
                            <a href="{% url 'admin:core_investment_changelist' %}" class="btn btn-outline-primary w-100">
                                <i class="fas fa-chart-line"></i> Investments
                            </a>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-md-3 mb-2">
                            <a href="{% url 'manage_companies' %}" class="btn btn-outline-primary w-100">
                                <i class="fas fa-building"></i> Companies
                            </a>
                        </div>
                        <div class="col-md-3 mb-2">
                            <a href="{% url 'manage_investment_plans' %}" class="btn btn-outline-primary w-100">
                                <i class="fas fa-chart-bar"></i> Investment Plans
                            </a>
                        </div>
                        <div class="col-md-3 mb-2">
                            <a href="{% url 'lead_dashboard' %}" class="btn btn-outline-primary w-100">
                                <i class="fas fa-envelope"></i> Leads
                            </a>
                        </div>
                        <div class="col-md-3 mb-2">
                            <a href="{% url 'capitalx_admin:index' %}" class="btn btn-outline-primary w-100">
                                <i class="fas fa-cogs"></i> Full Admin
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}