{% extends "core/emails/base_email.html" %}

{% block subject %}🏛️ EFT Deposit - R{{ amount|floatformat:2 }} from {{ user.username }}{% endblock %}

{% block content %}
<div class="greeting">
    🏛️ New EFT Deposit Notification
</div>

<div class="main-content">
    <p>Hello Admin,</p>
    
    <p>A new EFT deposit has been submitted and is awaiting your review in the admin panel.</p>
    
    <div class="info-box" style="border-left: 4px solid #007bff;">
        <h3>🏛️ EFT Deposit Details</h3>
        <table class="info-table">
            <tr>
                <td class="label">User:</td>
                <td class="value"><strong>{{ user.get_full_name|default:user.username }}</strong> ({{ user.email }})</td>
            </tr>
            <tr>
                <td class="label">Amount:</td>
                <td class="value"><span class="amount" style="color: #007bff; font-size: 1.2em;">R{{ amount|floatformat:2 }}</span></td>
            </tr>
            <tr>
                <td class="label">Payment Method:</td>
                <td class="value">{{ payment_method }}</td>
            </tr>
            <tr>
                <td class="label">Status:</td>
                <td class="value"><span class="badge" style="background: #ffc107; color: #000; padding: 4px 8px; border-radius: 4px;">Pending Review</span></td>
            </tr>
            <tr>
                <td class="label">Submitted:</td>
                <td class="value">{{ submitted_date|date:"M d, Y H:i" }}</td>
            </tr>
            <tr>
                <td class="label">Deposit ID:</td>
                <td class="value">#{{ deposit.id }}</td>
            </tr>
        </table>
    </div>
    
    <div class="info-box">
        <h3>🏛️ EFT Payment Details</h3>
        <p>Reference provided by user: <strong>{{ deposit.admin_notes|default:"No reference provided" }}</strong></p>
        {% if deposit.proof_image %}
        <p><strong>Proof of payment uploaded:</strong> ✅</p>
        <p><a href="{{ site_url }}{{ deposit.proof_image.url }}" target="_blank">View Proof of Payment</a></p>
        {% else %}
        <p><strong style="color: #dc3545;">⚠️ No proof of payment uploaded!</strong></p>
        {% endif %}
    </div>
    
    <!-- Extract bank account information from admin notes -->
    {% if deposit.admin_notes %}
        {% if "TymeBank" in deposit.admin_notes %}
        <div class="info-box" style="border-left: 4px solid #0056b3;">
            <h3>🏦 Bank Account Information</h3>
            <table class="info-table">
                <tr>
                    <td class="label">Bank:</td>
                    <td class="value">TymeBank</td>
                </tr>
                <tr>
                    <td class="label">Account Holder:</td>
                    <td class="value">Mr Sambo</td>
                </tr>
                <tr>
                    <td class="label">Account Name:</td>
                    <td class="value">EveryDay account</td>
                </tr>
                <tr>
                    <td class="label">Account Type:</td>
                    <td class="value">Current Account</td>
                </tr>
                <tr>
                    <td class="label">Account Number:</td>
                    <td class="value">51128444674</td>
                </tr>
                <tr>
                    <td class="label">Branch Code:</td>
                    <td class="value">678910</td>
                </tr>
                <tr>
                    <td class="label">PayShap ID:</td>
                    <td class="value">0642726273@Tymebank</td>
                </tr>
            </table>
        </div>
        {% elif "Discovery" in deposit.admin_notes %}
        <div class="info-box" style="border-left: 4px solid #0056b3;">
            <h3>🏦 Bank Account Information</h3>
            <table class="info-table">
                <tr>
                    <td class="label">Bank:</td>
                    <td class="value">Discovery Bank</td>
                </tr>
                <tr>
                    <td class="label">Account Holder:</td>
                    <td class="value">Thabang Nkwana</td>
                </tr>
                <tr>
                    <td class="label">Account Type:</td>
                    <td class="value">Savings Account</td>
                </tr>
                <tr>
                    <td class="label">Account Number:</td>
                    <td class="value">17856296290</td>
                </tr>
                <tr>
                    <td class="label">Branch Code:</td>
                    <td class="value">679000</td>
                </tr>
                <tr>
                    <td class="label">BIC/SWIFT:</td>
                    <td class="value">DISCZAJJXXX</td>
                </tr>
            </table>
        </div>
        {% endif %}
    {% endif %}
    
    <div class="info-box" style="border-left: 4px solid #28a745;">
        <h3>👤 User Information</h3>
        <table class="info-table">
            <tr>
                <td class="label">Full Name:</td>
                <td class="value">{{ user.get_full_name|default:"Not provided" }}</td>
            </tr>
            <tr>
                <td class="label">Email:</td>
                <td class="value">{{ user.email }}</td>
            </tr>
            <tr>
                <td class="label">Phone:</td>
                <td class="value">{{ user.phone|default:"Not provided" }}</td>
            </tr>
            <tr>
                <td class="label">Join Date:</td>
                <td class="value">{{ user.date_joined|date:"M d, Y" }}</td>
            </tr>
            <tr>
                <td class="label">Email Verified:</td>
                <td class="value">{% if user.is_email_verified %}✅ Yes{% else %}❌ No{% endif %}</td>
            </tr>
        </table>
    </div>
    
    <div style="text-align: center; margin: 30px 0;">
        <a href="{{ admin_panel_url }}{{ deposit.id }}/change/" class="btn" style="background: #007bff; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; display: inline-block; margin: 5px;">
            🔍 Review Deposit
        </a>
        <a href="{{ admin_panel_url }}" class="btn" style="background: #28a745; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; display: inline-block; margin: 5px;">
            📋 All Deposits
        </a>
    </div>
    
    <div class="info-box">
        <h3>⚡ Quick Actions Available in Admin Panel</h3>
        <ul style="margin: 15px 0; padding-left: 20px;">
            <li><strong>✅ Approve:</strong> Add funds to user's wallet and notify them</li>
            <li><strong>❌ Reject:</strong> Decline deposit and notify user with reason</li>
            <li><strong>📝 Add Notes:</strong> Add internal notes for record keeping</li>
            <li><strong>📊 View History:</strong> See all deposits from this user</li>
        </ul>
    </div>
    
    <div class="info-box" style="background: #f8f9fa; border-left: 4px solid #6c757d;">
        <h3>ℹ️ Important Notes for EFT Deposits</h3>
        <ul style="margin: 15px 0; padding-left: 20px;">
            <li>EFT deposits typically take 1-3 business days to clear</li>
            <li>Always verify the proof of payment before approving</li>
            <li>Check that the reference number matches the user's submission</li>
            <li>Verify the amount matches what was transferred</li>
        </ul>
    </div>
    
    <p style="margin-top: 30px;">Please review this deposit at your earliest convenience. Users are notified when their deposits are approved or rejected.</p>
    
    <p>Best regards,<br><strong>CapitalX Platform System</strong></p>
</div>
{% endblock %}