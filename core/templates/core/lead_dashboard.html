{% extends "base.html" %}

{% block title %}Email Lead System - Dashboard{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-0">üìß Email Lead System</h1>
            <p class="text-muted">Automated lead generation and outreach for CapitalX</p>
        </div>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#newCampaignModal">
            <i class="bi bi-plus-circle"></i> New Campaign
        </button>
    </div>

    <!-- Statistics Cards -->
    <div class="row g-4 mb-5">
        <div class="col-md-3">
            <div class="card stat-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title text-muted mb-0">Total Campaigns</h6>
                            <h2 class="text-primary">{{ total_campaigns }}</h2>
                        </div>
                        <div class="stat-icon bg-primary">
                            <i class="bi bi-folder2-open"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="card stat-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title text-muted mb-0">Active Campaigns</h6>
                            <h2 class="text-success">{{ active_campaigns }}</h2>
                        </div>
                        <div class="stat-icon bg-success">
                            <i class="bi bi-play-circle"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="card stat-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title text-muted mb-0">Total Leads</h6>
                            <h2 class="text-info">{{ total_leads }}</h2>
                        </div>
                        <div class="stat-icon bg-info">
                            <i class="bi bi-people"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="card stat-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title text-muted mb-0">Success Rate</h6>
                            <h2 class="text-warning">{{ success_rate }}%</h2>
                        </div>
                        <div class="stat-icon bg-warning">
                            <i class="bi bi-graph-up"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Recent Campaigns -->
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">üìÅ Recent Campaigns</h5>
                    <a href="{% url 'lead_analytics' %}" class="btn btn-sm btn-outline-primary">View Analytics</a>
                </div>
                <div class="card-body">
                    {% if recent_campaigns %}
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Campaign</th>
                                        <th>Leads</th>
                                        <th>Success Rate</th>
                                        <th>Status</th>
                                        <th>Created</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for campaign in recent_campaigns %}
                                    <tr>
                                        <td>
                                            <strong>{{ campaign.name }}</strong>
                                            {% if campaign.description %}
                                                <br><small class="text-muted">{{ campaign.description|truncatechars:50 }}</small>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <span class="badge bg-info">{{ campaign.total_leads }}</span>
                                        </td>
                                        <td>
                                            <span class="badge bg-{% if campaign.success_rate >= 50 %}success{% elif campaign.success_rate >= 25 %}warning{% else %}danger{% endif %}">
                                                {{ campaign.success_rate }}%
                                            </span>
                                        </td>
                                        <td>
                                            {% if campaign.is_active %}
                                                <span class="badge bg-success">Active</span>
                                            {% else %}
                                                <span class="badge bg-secondary">Inactive</span>
                                            {% endif %}
                                        </td>
                                        <td>{{ campaign.created_at|date:"M d, Y" }}</td>
                                        <td>
                                            <a href="{% url 'campaign_detail' campaign.id %}" class="btn btn-sm btn-outline-primary">
                                                <i class="bi bi-eye"></i> View
                                            </a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="text-center py-4">
                            <i class="bi bi-folder-x display-1 text-muted"></i>
                            <h5 class="mt-3">No campaigns yet</h5>
                            <p class="text-muted">Create your first campaign to start generating leads</p>
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#newCampaignModal">
                                Create Campaign
                            </button>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">üìà Recent Activity</h5>
                </div>
                <div class="card-body">
                    {% if recent_emails %}
                        <div class="activity-list">
                            {% for email in recent_emails %}
                            <div class="activity-item">
                                <div class="activity-icon bg-success">
                                    <i class="bi bi-envelope-check"></i>
                                </div>
                                <div class="activity-content">
                                    <p class="mb-1"><strong>Email sent</strong></p>
                                    <p class="mb-0 text-muted small">{{ email.email_address }}</p>
                                    <small class="text-muted">{{ email.sent_at|timesince }} ago</small>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-4">
                            <i class="bi bi-clock-history display-4 text-muted"></i>
                            <p class="text-muted mt-2">No recent activity</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- New Campaign Modal -->
<div class="modal fade" id="newCampaignModal" tabindex="-1" aria-labelledby="newCampaignModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title" id="newCampaignModalLabel">üÜï Create New Campaign</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="campaign_name" class="form-label">Campaign Name *</label>
                        <input type="text" class="form-control" id="campaign_name" name="campaign_name" required>
                        <div class="form-text">Choose a descriptive name for your campaign</div>
                    </div>
                    <div class="mb-3">
                        <label for="campaign_description" class="form-label">Description</label>
                        <textarea class="form-control" id="campaign_description" name="campaign_description" rows="3"></textarea>
                        <div class="form-text">Optional description of your campaign goals</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Campaign</button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
.stat-card {
    border: none;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transition: transform 0.2s;
}

.stat-card:hover {
    transform: translateY(-2px);
}

.stat-icon {
    width: 50px;
    height: 50px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.5rem;
}

.activity-list {
    max-height: 400px;
    overflow-y: auto;
}

.activity-item {
    display: flex;
    align-items: start;
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #eee;
}

.activity-item:last-child {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
}

.activity-icon {
    width: 35px;
    height: 35px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 0.9rem;
    margin-right: 12px;
    flex-shrink: 0;
}

.activity-content {
    flex: 1;
}
</style>
{% endblock %}
